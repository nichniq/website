<!doctype html>

<html lang="en">
    <head>
        <title>Nick Cassleman - Library catalog</title>

        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
    </head>

    <body>
        <script type="module">
            import catalog from "./catalog.js";

            const text = (content) => [ document.createTextNode(content) ];

            const element = (tag, content = [], attributes = {}) => {
                const element = document.createElement(tag);

                for ( const child of content ) {
                    element.appendChild(child);
                }

                for ( const [ name, value ] of Object.entries(attributes) ) {
                    element.setAttribute(name, value);
                }

                return [ element ];
            };

            const maybe = (truthy, array) => truthy ? array : [];

            const title = ({ title, subtitle, series }) => element("cite", [
                    ...element("cite", text(title)),
                    ...maybe(subtitle, text(`: ${subtitle}`)),
                    ...maybe(series, text(` (${series})`)),
                ], {
                    "data-medium": "book"
                }
            );

            const ISBN13 = "International Standard Book Number, 13-digit";
            const ISBN10 = "International Standard Book Number, 10-digit";
            const LCCN = "Library of Congress Control Number";

            const first = (arrays) => arrays.find((x) => x.length > 0) || [];

            const id = ({ ids = [] }) => {
                const { isbn13, isbn10, lccn } = Object.fromEntries(ids);

                const option = (abbr, title, content) => maybe(content, [
                    ...element("abbr", text(abbr), { title }),
                    ...text(`: ${content}`),
                ]);

                return first([
                    option("ISBN13", ISBN13, isbn13),
                    option("LCCN", LCCN, lccn),
                    option("ISBN10", ISBN10, isbn10),
                ]);
            };

            const book = (book) => element("tr", [
                ...element("td", title(book)),
                ...element("td", id(book)),
            ]);

            const headings = [ "Title", "ID" ].flatMap(
                (x) => element("th", text(x))
            );

            const books = catalog.flatMap(book);

            const [ table ] = element("table", [
                ...element("thead", element("tr", headings)),
                ...element("tbody", books),
            ]);

            document.body.replaceWith(table);
        </script>
    </body>
</html>
