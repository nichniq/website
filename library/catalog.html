<style>
  table {
    background-color: white;
    border-collapse: collapse;
    text-align: left;
  }

  thead {
    background-color: inherit;
    position: sticky;
    top: 0;
  }

  thead::after {
    display: block;
    content: "";
    background-color: black;
    height: 1px;
    position: absolute;
    left: 0;
    right: 0;
    bottom: 0;
  }

  thead > tr > th {
    padding: 0.5em;
  }

  tbody > tr > td {
    padding: 0.25em 0.5em;
  }
</style>

<h2>Catalog</h2>

<script type="module" id="catalog">

import books from "/library/catalog.js";
import { maybe, first, unzip } from "/modules/lisp.js";
import { tags } from "/modules/element.js";

const { cite, abbr, a, tr, table, th, td, thead, tbody } = tags;

const ISBN13 = "International Standard Book Number, 13-digit";
const ISBN10 = "International Standard Book Number, 10-digit";
const LCCN = "Library of Congress Control Number";
const EAN = "European Article Number";

const title = ({ title, subtitle, series }) => [
  cite([
      title,
      maybe(subtitle, `: ${subtitle}`),
    ],
    { "data-medium": "book" }
  ),
  maybe(series, ` (${series})`),
];

const id = ({ ids = [] }) => {
  const { isbn13, isbn10, lccn, ean } = Object.fromEntries(ids);

  const option = (short, title, content) => maybe(content,
    [ abbr(short, { title }), `: ${content}` ]
  );

  return first([
    option("ISBN13", ISBN13, isbn13),
    option("LCCN", LCCN, lccn),
    option("ISBN10", ISBN10, isbn10),
    option("EAN", EAN, ean),
  ]);
};

const link = ({ title, external }) => maybe(external,
  a("link", {
    title,
    href: external,
    referrerpolicy: "no-referrer",
    rel: "noopener",
  })
);

const city = ({ txns = [] }) => {
  const txn = first(txns);
  const [ method, { city } = {} ] = txn;

  return maybe(city, city);
};

const date = ({ txns = [] }) => {
  const txn = first(txns);
  const [ method, { date } = {} ] = txn;

  return maybe(date, date);
};

const [ titles, columns ] = unzip([
  [ "Title", title ],
  [ "ID", id ],
  [ "Link", link ],
  [ "Date", date ],
  [ "City", city ],
]);

const [ catalog ] = table([
  thead(
    tr(
      titles.map((title) => th(title))
    )
  ),
  tbody(
    books.map(
      (book) => tr(
        columns.map((col) => td(col(book)))
      )
    )
  ),
]);

document.getElementById("catalog").replaceWith(catalog);

</script>
