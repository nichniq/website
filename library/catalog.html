<!doctype html>

<html lang="en">
    <head>
        <title>Nick Cassleman - Library catalog</title>

        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />

        <script>
            /**
             * This might look like a strange function; I was trying to
             * accomplish a few things:
             *
             * 1. Single source of truth for header + column ordering
             * 2. Direct way of mapping values of input to output
             * 3. Centralized encoding of defaults
             * 4. Minimize helper code; keep it short, clear, simple
             * 5. Provide metadata that sits alongside the results for later use
             */

            function flattenBook(book = {}) {
                const id = (ids = [], search) => ids.reduce(
                    (id, [ type, data ]) => type === search ? data : id,
                    undefined
                );

                const firstTxn = ([ [ type, data ] = [] ] = []) => ({
                    date: data?.date,
                    location: data?.location,
                    city: data?.city,
                    method: type,
                });

                return {
                    "Title":             book.title                   || "",
                    "Subtitle":          book.subtitle                || "",
                    "Series":            book.series                  || "",
                    "ISBN":              id(book.ids, "isbn10")       || "",
                    "ISBN-13":           id(book.ids, "isbn13")       || "",
                    "LCCN":              id(book.ids, "lccn")         || "",
                    "External link":     book.external                || "",
                    "Date acquired":     firstTxn(book.txns).date     || "",
                    "Location acquired": firstTxn(book.txns).location || "",
                    "City acquired":     firstTxn(book.txns).city     || "",
                    "Method acquired":   firstTxn(book.txns).method   || "",
                    "Notes":             book.notes                   || "",
                };
            }
        </script>

        <script>
            function element(tag, content = [], attributes = {}) {
                const element = document.createElement(tag);

                for ( const child of [ content ].flat(1) ) {
                    element.appendChild(child);
                }

                for ( const [ name, value ] of Object.entries(attributes) ) {
                    element.setAttribute(name, value);
                }

                return element;
            }
        </script>

        <script>
            /**
             * There are a lot of ways I could slice this one. I wasn't sure
             * what I should compose, what I should repeat, what I should pass
             * in. The new introduction is the `element` shorthand.
             */

            function tableFromBooks(books) {
                const headings = Object.keys(flattenBook());
                const rows = books.map((x) => Object.values(flattenBook(x)));

                const text = (content) => document.createTextNode(content);
                const row = (type) => (cells) => element("tr",
                    cells.map(
                        (col) => element(type, text(col))
                    )
                );

                return element("table",
                    [
                        element("thead", row("th")(headings)),
                        element("tbody", rows.map(row("td"))),
                    ]

                    // tbody of rows where-each row of td
                    // tbody of rows (wher-eeach row of td)
                    // tbody of (rows where-each (row of td))

                    // tbody of rows, where row is td
                    // tbody is rows where row of td
                    // tbody is rows where row(s) of td
                    // tbody is rows (where row (s) are td)

                    // associative, so the parens are just to be clear
                    // synonyms, aliases
                );
            }
        </script>
    </head>

    <body>
        <template id="table-placeholder"></template>

        <script type="module">
            import catalog from "./catalog.js";

            document.getElementById("table-placeholder").replaceWith(
                tableFromBooks(catalog)
            );
        </script>
    </body>
</html>
