<!doctype html>

<html lang="en">
    <head>
        <title>Nick Cassleman - Library catalog</title>

        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
    </head>

    <body>
        <script type="module">
            import catalog from "./catalog.js";

            import { text, element, tags } from "/scripts/html.js";
            const { cite, abbr, a, tr, table, th, td, thead, tbody } = tags;

            const ISBN13 = "International Standard Book Number, 13-digit";
            const ISBN10 = "International Standard Book Number, 10-digit";
            const LCCN = "Library of Congress Control Number";

            const maybe = (truthy, array) => truthy ? array : [];
            const first = (arrays) => arrays.find((x) => x.length > 0) || [];
            const unzip = (entries) => {
                const map = Object.fromEntries(entries);
                return [ Object.keys(map), Object.values(map) ];
            };

            const title = ({ title, subtitle, series }) => [
                ...cite(
                    [
                        ...text(title),
                        ...maybe(subtitle, text(`: ${subtitle}`)),
                    ],
                    { "data-medium": "book" }
                ),
                ...maybe(series, text(` (${series})`)),
            ];

            const id = ({ ids = [] }) => {
                const { isbn13, isbn10, lccn } = Object.fromEntries(ids);

                const option = (short, title, content) => maybe(content, [
                    ...abbr(text(short), { title }),
                    ...text(`: ${content}`),
                ]);

                return first([
                    option("ISBN13", ISBN13, isbn13),
                    option("LCCN", LCCN, lccn),
                    option("ISBN10", ISBN10, isbn10),
                ]);
            };

            const link = ({ external }) => maybe(external,
                a(text(external), { href: external })
            );

            const [ titles, columns ] = unzip([
                [ "Title", title ],
                [ "ID", id ],
                [ "Link", link ],
            ]);

            const row = (type, columns) => tr(columns.flatMap(
                (content) => element(type, content)
            ));

            const [ books ] = table([
                ...thead(
                    row("th", titles.map((title) => text(title)))
                ),
                ...tbody(catalog.flatMap(
                    (book) => row("td", columns.map((col) => col(book)))
                )),
            ]);

            document.body.replaceWith(books);
        </script>
    </body>
</html>
