<!doctype html>

<title>Visual inspiration</title>

<meta charset="utf-8" />

<style>
  .canvas {
    position: relative;
    border: 1px solid black;
    height: 400px;
  }

  .canvas > .image {
    position: absolute;
  }
</style>

<div class="canvas">{{# images }}
  <img
    async
    class="image"
    src="/images/thumbnails/{{{ path }}}"
    style="
      z-index: {{ zIndex }};
      left: {{ x }}px;
      top: {{ y }}px;
    "
  />{{/ images }}
</div>

<script type="module">
  fetch("/", {
    method: "POST",
    body: JSON.stringify([ "TEST", {
      path: "path/to/file",
      x: 0,
      y: 0,
    }])
  });

  const set_position = (image, x, y) => {
    image.style.left = `${x}px`;
    image.style.top = `${y}px`;
  };

  for (const image of document.querySelectorAll(".image")) {
    const container = image.parentElement;

    image.addEventListener("mousedown", down_event => {
      down_event.preventDefault();

      const initial = {
        x: image.offsetLeft,
        y: image.offsetTop,
      };

      const move = event => set_position(image, event.x, event.y);
      const cancel = event => {
        if (event.key === "Escape") {
          set_position(image, initial.x, initial.y);

          document.removeEventListener("mousemove", move);
          document.removeEventListener("keydown", cancel);
        }
      };

      document.addEventListener("mousemove", move);
      document.addEventListener("keydown", cancel);

      document.addEventListener("mouseup", () => {
        document.removeEventListener("mousemove", move);
        document.removeEventListener("keydown", cancel);
      });
    })
  }
</script>
