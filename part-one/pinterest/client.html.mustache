<!doctype html>

<title>Visual inspiration</title>

<meta charset="utf-8" />

<style>
  .canvas {
    border: 1px solid black;
    height: 400px;
    overflow: hidden;
    position: relative;
  }

  .canvas > .image {
    cursor: move;
    position: absolute;
  }
</style>

<div class="canvas">{{# images }}
  <img
    loading="lazy"
    class="image"
    src="/images/thumbnails/{{{ path }}}"
    style="left: {{ x }}px; top: {{ y }}px;"
  />{{/ images }}
</div>

<script type="module">
  fetch("/", {
    method: "POST",
    body: JSON.stringify([ "TEST", {
      path: "path/to/file",
      x: 0,
      y: 0,
    }])
  });

  const set_position = ({ image, x, y }) => {
    image.style.left = `${x}px`;
    image.style.top = `${y}px`;
  };

  for (const image of document.querySelectorAll(".image")) {
    const container = image.parentElement;

    image.addEventListener("mousedown", event => {
      event.preventDefault();

      const initial = { x: image.offsetLeft, y: image.offsetTop };
      const offset = { x: event.x - image.x, y: event.y - image.y };

      console.log(initial);
      console.log(offset);

      const move = event => {
        set_position({
          image,
          x: event.x - offset.x - container.offsetLeft,
          y: event.y - offset.y - container.offsetTop,
        });
      }
      const cancel = event => {
        if (event.key === "Escape") {
          set_position({ image, x: initial.x, y: initial.y });

          document.removeEventListener("mousemove", move);
          document.removeEventListener("keydown", cancel);
        }
      };

      document.addEventListener("mousemove", move);
      document.addEventListener("keydown", cancel);

      document.addEventListener("mouseup", () => {
        document.removeEventListener("mousemove", move);
        document.removeEventListener("keydown", cancel);
      });
    })
  }
</script>
