<!doctype html>

<title>Part One</title>

<style>
  body {
    margin: 0;
  }

  *:first-child {
    margin-top: 0;
  }

  *:last-child {
    margin-bottom: 0;
  }

  .outline {
    height: 100vh;
    display: flex;
    flex-direction: row;
    flex-wrap: nowrap;
    gap: 15px;
  }

  .generation {
    flex: 0 0 300px;
    overflow: hidden scroll;
    background-color: rgba(0, 0, 0, 0.2);
    display: flex;
    flex-direction: column;
    gap: 15px;
  }

  .node {
    background-color: rgba(255, 255, 255, 0.5);
  }
</style>

<body></body>

<script type="module">
  import { tags } from "/modules/element.js";
  import gingko from "./scripts/import_gingko.js";
  import render_md from "./scripts/markdown.js";

  const { ol, li, textarea, div } = tags;
  const publish = obj => Object.entries(obj).forEach(([k,v]) => window[k] = v);
  const print = obj => Object.entries(obj).forEach(([k,v]) => console.log(k, v));

  const { origin, registry, generations } = await gingko("./gingko-export.json");

  publish({ origin, registry, generations });
  print({ origin, registry, generations });

  const node_to_ui = node => div(
    render_md(node.content),
    { class: "node", "data-id": node.id, "data-parent-id": node.parent_id },
  );
  const generation_to_ui = generation => div(
    generation.map(node => node_to_ui(node)),
    { class: "generation" },
  );
  const generations_to_ui = generations => div(
    generations.map(gen => generation_to_ui(gen)),
    { class: "outline" },
  );

  const [ ui ] = generations_to_ui(generations);
  document.body.append(ui);
</script>
