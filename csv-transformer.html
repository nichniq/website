<!doctype html>

<html lang="en">
    <head>
        <title>Nick Cassleman - CSV transformer</title>

        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />

        <style>
            .block { display: block }
            .full-width { width: 100% }
            .preformatted { white-space: pre }
            .bold { font-weight: bold }
        </style>
    </head>

    <body>
        <form>
            <label class="bold">
                CSV data

                <textarea
                    id="csv-input"
                    name="csv"
                    rows="10"
                    class="full-width preformatted block"
                ></textarea>
            </label>

            <button>Parse</button>

            <output style="display: block; padding-top: 3rem">
                <label class="bold">
                    Result

                    <textarea
                        id="csv-output"
                        for="csv-input"
                        readonly
                        rows="10"
                        class="full-width preformatted block"
                    ></textarea>
                </label>
            </output>
        </form>

        <script>
            function *processCommas(row) {
                const queue = [];
                let insideQuote = false;

                for (const char of row) {
                    switch (char) {
                        case ",":
                            if (insideQuote) {
                                queue.push(char);
                            } else {
                                yield queue.join("");
                                queue.splice(0, queue.length);
                            }
                            break;

                        case '"':
                            insideQuote = !insideQuote;
                            break;

                        default:
                            queue.push(char);
                            break;
                    }
                }
            }

            document.onsubmit = function captureSubmission(submission) {
                submission.preventDefault();

                const form = submission.target;
                const action = new URL(form.action).pathname;
                const data = Object.fromEntries(new FormData(form).entries());
                const [ header, ...rows ] = data.csv.split("\n");

                debugger;

                document.getElementById("csv-output").value = data.csv + "!";
            }
        </script>
    </body>
</html>
