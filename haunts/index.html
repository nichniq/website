<!doctype html>

<html lang="en">

<title>Nick Cassleman - Haunts</title>

<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />

<link rel="stylesheet" type="text/css" href="/globals.css" />

<style>
  dt {
    font-variant: small-caps;
    text-decoration: underline;
    font-weight: bold;
    margin-bottom: 0.5em;
  }

  * + dt {
    margin-top: 0.5rem;
  }

  dd {
    margin: 0;
  }

  body {
    display: grid;
    grid:
      "header      header" auto
      "coffeeshops bookstores" auto
      "bars        bookstores" auto
      "florists    bookstores" auto
      "theaters    bookstores" auto
      / 1fr 1fr;
    column-gap: 3rem;
    justify-items: start;

  }

  .header { grid-area: header }
  .coffeeshops { grid-area: coffeeshops }
  .bars { grid-area: bars }
  .florists { grid-area: florists }
  .bookstores { grid-area: bookstores }
  .theaters { grid-area: theaters }
</style>

<header class="header" style="margin-bottom: 1rem">
  <h1><a href="/">Nick Cassleman</a> - Haunts</h1>

  <p>I love being a regular! In the places I've lived, I've made an effort to find the spots that I really like and befriend the staff and fellow regulars. The connections are fleeting: I've moved a lot, and conversation is often light, but I'm grateful for all the different folks I've met.</p>

  <button type="button" onclick="setDetailsOpen(true)">
    Open all
  </button>

  <button type="button" onclick="setDetailsOpen(false)">
    Close all
  </button>

  <script>
    function setDetailsOpen(isOpen) {
      for ( const detail of document.getElementsByTagName("details") ) {
        detail.open = isOpen;
      }
    }
  </script>
</header>

<details class="coffeeshops">
  <summary>
    <h2>Coffeeshops</h2>
  </summary>

  <dl>
    <dt>San Francisco</dt>
      <dd>Café International</dd>
      <dd>Café du Soleil</dd>
      <dd>Fayes</dd>

    <dt>Brooklyn</dt>
        <dd>Breukelen</dd>
        <dd>Cafe Eloise</dd>

    <dt>Chicago</dt>
        <dd>Z&H MarketCafe</dd>
  </dl>
</details>

<details class="bars">
  <summary>
    <h2>Bars</h2>
  </summary>

  <dl>
    <dt>San Francisco</dt>
      <dd>Pilsner Inn</dd>
      <dd>The Page</dd>

    <dt>Brooklyn</dt>
      <dd>Covenhoven</dd>
      <dd>Berg'n</dd>

    <dt>Chicago</dt>
      <dd>The Cove</dd>
      <dd>The Pub</dd>
  </dl>
</details>

<details class="florists">
  <summary>
    <h2>Florists</h2>
  </summary>

  <dl>
    <dt>San Francisco</dt>
        <dd>Her Urban Herbs</dd>

    <dt>Brooklyn</dt>
        <dd>Park Deli</dd>
  </dl>
</details>

<details class="bookstores">
  <summary>
    <h2>Bookstores</h2>
  </summary>

  <p>I've been to a lot of bookstores! Here's some of the data I've recorded about where I've purchased books.</p>

  <h3>Top bookstores</h3>

  <script id="top_bookstores" type="module">
    import books from "/library/catalog.js";
    import { tags } from "/modules/element.js";
    import { decr } from "/modules/compare.js"

    const { ol, li } = tags;

    const bookstore_counts = books.reduce(
      (store_counts, book) => {
        const { txns: [ [ type, txn ] = [] ] = [] } = book; // get pieces

        if (type === "purchase" && txn?.location && txn?.city) { // if match
          if (store_counts[txn.location] == null) { // do we have this store?
            store_counts[txn.location] = 0; // if not, initialize it to zero
          }
          store_counts[txn.location] += 1; // add one to the store accumulator
        }

        return store_counts; // return bookstore counts
      },
      {}
    )

    const tops = Object.entries(bookstore_counts)
      .sort((a, b) => decr(a[1], b[1])) // decrease by bookstore count
      .slice(0, 5) // take top five
      .map(([ location, count ]) => `${location} (${count})`); // format entry

    const [ list ] = ol(tops.map(store => li(store)));
    document.getElementById("top_bookstores").replaceWith(list);
  </script>

  <h3>All bookstores</h3>

  <script id="all_bookstores" type="module">
    import books from "/library/catalog.js";
    import { tags } from "/modules/element.js";
    import { strict, atoz, decr } from "/modules/compare.js"

    const { dl, dt, dd } = tags;

    const bookstores = books.reduce(
      (cities_to_stores, book) => {
        const { txns: [ [ type, txn ] = [] ] = [] } = book; // get pieces

        if (type === "purchase" && txn?.location && txn?.city) { // if match
          if (cities_to_stores[txn.city] == null) { // do we have this city?
            cities_to_stores[txn.city] = new Set(); // if not, add a new set
          }
          cities_to_stores[txn.city].add(txn.location); // add location to city
        }

        return cities_to_stores; // return map of cities
      },
      {}
    );

    const bookstore_entires = Object.entries(bookstores).sort((a, b) =>
      strict(a[1].size, b[1].size) // check number of stores in city
        ? atoz(a[0], b[0]) // if same, alphabetize by city name
        : decr(a[1].size, b[1].size) // else, order city by decreasing count
    );

    const [ list ] = dl(
      bookstore_entires.flatMap(([ city, locations ]) => [
        dt(city),
        [ ...locations ].sort(atoz).map(location => dd(location)),
      ]),
      { style: "columns: 2" }
    );

    document.getElementById("all_bookstores").replaceWith(list);
  </script>
</details>

<details class="theaters">
  <summary>
    <h2>Theaters</h2>
  </summary>

  <script id="theaters" type="module">
  </script>
</details>

<script>
  setDetailsOpen(true);
</script>
